<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Registro de Ocorrências Escolares</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #1a73e8;
            --primary-dark: #0d47a1;
            --secondary-color: #f8f9fa;
            --accent-color: #f1c40f;
            --success-color: #2ecc71;
            --error-color: #e74c3c;
            --border-color: #dadce0;
            --text-color: #202124;
            --light-text: #5f6368;
            --card-bg: #ffffff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --hover-bg: #f0f5ff;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 60px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #2ecc71 0%, #3498db 100%);
            border-bottom: 1px solid var(--border-color);
            padding: 15px 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            width: 55px;
            height: 55px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .logo-text h1 {
            font-size: 1.6rem;
            color: white;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .logo-text p {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 3px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        main {
            padding: 30px 0;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .stats-card {
            background: linear-gradient(135deg, #2ecc71 0%, #3498db 100%);
            color: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
            position: relative;
            z-index: 2;
        }
        
        .stat-item {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: var(--transition);
        }
        
        .stat-item:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.25);
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .stat-label {
            font-size: 0.95rem;
            opacity: 0.9;
        }
        
        .card {
            background-color: var(--card-bg);
            border-radius: 16px;
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 20px 30px;
            font-size: 1.35rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .card-body {
            padding: 30px;
        }
        
        .student-occurrences-card {
            background: linear-gradient(135deg, #2ecc71 0%, #3498db 100%);
            color: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-top: 25px;
            display: none;
        }
        
        .student-occurrences-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .student-occurrences-name {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .student-occurrences-count {
            font-size: 3rem;
            font-weight: 700;
            margin: 10px 0;
            text-shadow: 0 3px 6px rgba(0,0,0,0.3);
        }
        
        .student-occurrences-label {
            font-size: 1.1rem;
            opacity: 0.9;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: var(--text-color);
            font-size: 1.1rem;
            transition: var(--transition);
            cursor: pointer;
        }
        
        .required::after {
            content: " *";
            color: var(--error-color);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5eb;
            border-radius: 10px;
            font-size: 16px;
            transition: var(--transition);
            background-color: #f8fafc;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(26, 115, 232, 0.2);
            background-color: white;
            transform: translateY(-2px);
        }
        
        textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .checkbox-group {
            margin-bottom: 20px;
        }
        
        .checkbox-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 18px;
        }
        
        .checkbox-item {
            background: #f8fafc;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e1e5eb;
            transition: var(--transition);
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .checkbox-item:hover {
            background: #e8f0fe;
            border-color: var(--primary-color);
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .checkbox-item input {
            width: auto;
            margin-right: 12px;
            transform: scale(1.2);
            cursor: pointer;
        }
        
        .chart-container {
            width: 50px;
            height: 50px;
            margin-right: 15px;
            position: relative;
        }
        
        .chart-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: 700;
            font-size: 14px;
            color: var(--primary-dark);
            z-index: 2;
            pointer-events: none;
        }
        
        .actions {
            display: flex;
            gap: 18px;
            padding-top: 25px;
            border-top: 1px solid var(--border-color);
            margin-top: 25px;
        }
        
        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #0d62d9 0%, #0a4ebf 100%);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(26, 115, 232, 0.35);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #f8f9fa 0%, #e8eaed 100%);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #e8eaed 0%, #d7d9dd 100%);
            transform: translateY(-3px);
        }
        
        .btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        
        .alert {
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            display: none;
            font-size: 17px;
            font-weight: 500;
            align-items: center;
            gap: 15px;
        }
        
        .alert-success {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.15) 0%, rgba(39, 174, 96, 0.15) 100%);
            border: 1px solid var(--success-color);
            color: #27ae60;
        }
        
        .alert-error {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.15) 0%, rgba(192, 57, 43, 0.15) 100%);
            border: 1px solid var(--error-color);
            color: #c0392b;
        }
        
        .loading {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 4px solid rgba(26, 115, 232, 0.2);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .form-row {
            display: flex;
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .form-col {
            flex: 1;
        }
        
        .section-title {
            font-size: 1.3rem;
            color: var(--primary-color);
            margin: 35px 0 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e1e5eb;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }
        
        .loading-spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        
        .integration-status {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-connected {
            background-color: var(--success-color);
        }
        
        .status-disconnected {
            background-color: var(--error-color);
        }
        
        footer {
            background-color: var(--card-bg);
            border-top: 1px solid var(--border-color);
            padding: 25px 0;
            text-align: center;
            color: var(--light-text);
            font-size: 15px;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .footer-links a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .footer-links a:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }
        
        /* Responsividade */
        @media (max-width: 992px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .actions {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .checkbox-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>
    
    <header>
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div class="logo-text">
                    <h1>Registro de Ocorrências Escolares</h1>
                    <p>Sistema integrado com Google Sheets</p>
                </div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <main>
            <div class="dashboard">
                <div>
                    <div class="alert alert-success" id="successAlert">
                        <i class="fas fa-check-circle"></i> 
                        <div>
                            <strong>Ocorrência registrada com sucesso!</strong>
                            <p>Os dados foram enviados para a planilha de ocorrências.</p>
                        </div>
                    </div>
                    
                    <div class="alert alert-error" id="errorAlert">
                        <i class="fas fa-exclamation-circle"></i> 
                        <div>
                            <strong>Erro no preenchimento do formulário</strong>
                            <p id="errorMessage">Por favor, preencha todos os campos obrigatórios e selecione pelo menos uma irregularidade.</p>
                        </div>
                    </div>
                    
                    <div class="integration-status">
                        <i class="fas fa-plug"></i>
                        <div>
                            <strong>Status de integração:</strong> 
                            <span class="status-indicator status-connected" id="connectionStatus"></span>
                            <span id="connectionText">Conectado à planilha Google Sheets</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-clipboard-list"></i> Informações da Ocorrência
                        </div>
                        <div class="card-body">
                            <form id="occurrenceForm">
                                <div class="form-row">
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label for="professor" class="required">Nome do professor</label>
                                            <select id="professor" required>
                                                <option value="">Selecione seu nome</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label for="occurrenceDate" class="required">Data da ocorrência</label>
                                            <input type="date" id="occurrenceDate" required>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label for="studentClass" class="required">Turma</label>
                                            <select id="studentClass" required>
                                                <option value="">Selecione a turma</option>
                                                <option value="6° ANO A MANHA">6° ANO A MANHA</option>
                                                <option value="6° ANO B MANHA">6° ANO B MANHA</option>
                                                <option value="6° ANO C MANHA">6° ANO C MANHA</option>
                                                <option value="6° ANO D MANHA">6° ANO D MANHA</option>
                                                <option value="6° ANO E TARDE">6° ANO E TARDE</option>
                                                <option value="6° ANO F TARDE">6° ANO F TARDE</option>
                                                <option value="7° ANO A TARDE">7° ANO A TARDE</option>
                                                <option value="7° ANO B TARDE">7° ANO B TARDE</option>
                                                <option value="7° ANO C TARDE">7° ANO C TARDE</option>
                                                <option value="7° ANO D TARDE">7° ANO D TARDE</option>
                                                <option value="7° ANO E TARDE">7° ANO E TARDE</option>
                                                <option value="7° ANO F TARDE">7° ANO F TARDE</option>
                                                <option value="8° ANO A TARDE">8° ANO A TARDE</option>
                                                <option value="8° ANO B TARDE">8° ANO B TARDE</option>
                                                <option value="8° ANO C TARDE">8° ANO C TARDE</option>
                                                <option value="8° ANO D TARDE">8° ANO D TARDE</option>
                                                <option value="9° ANO A TARDE">9° ANO A TARDE</option>
                                                <option value="9° ANO B TARDE">9° ANO B TARDE</option>
                                                <option value="9° ANO C TARDE">9° ANO C TARDE</option>
                                                <option value="9° ANO D TARDE">9° ANO D TARDE</option>
                                                <option value="1ª SERIE A MANHA">1ª SERIE A MANHA</option>
                                                <option value="1ª SERIE B MANHA">1ª SERIE B MANHA</option>
                                                <option value="1ª SERIE C MANHA">1ª SERIE C MANHA</option>
                                                <option value="1ª SERIE D MANHA">1ª SERIE D MANHA</option>
                                                <option value="1ª SERIE E MANHA">1ª SERIE E MANHA</option>
                                                <option value="1ª SERIE F MANHA">1ª SERIE F MANHA</option>
                                                <option value="1ª SERIE G TARDE">1ª SERIE G TARDE</option>
                                                <option value="1ª SERIE H NOITE">1ª SERIE H NOITE</option>
                                                <option value="1ª SERIE I NOITE">1ª SERIE I NOITE</option>
                                                <option value="2ª SERIE A MANHA">2ª SERIE A MANHA</option>
                                                <option value="2ª SERIE B MANHA">2ª SERIE B MANHA</option>
                                                <option value="2ª SERIE C MANHA">2ª SERIE C MANHA</option>
                                                <option value="2ª SERIE D MANHA">2ª SERIE D MANHA</option>
                                                <option value="2ª SERIE E MANHA">2ª SERIE E MANHA</option>
                                                <option value="2ª SERIE F NOITE">2ª SERIE F NOITE</option>
                                                <option value="2ª SERIE G NOITE">2ª SERIE G NOITE</option>
                                                <option value="2ª SERIE H NOITE">2ª SERIE H NOITE</option>
                                                <option value="3ª SERIE A MANHA">3ª SERIE A MANHA</option>
                                                <option value="3ª SERIE B MANHA">3ª SERIE B MANHA</option>
                                                <option value="3ª SERIE C MANHA">3ª SERIE C MANHA</option>
                                                <option value="3ª SERIE D NOITE">3ª SERIE D NOITE</option>
                                                <option value="3ª SERIE E NOITE">3ª SERIE E NOITE</option>
                                                <option value="3ª SERIE F NOITE">3ª SERIE F NOITE</option>
                                                <option value="4050 - ADMINISTRAÇÃO - 2ª SERIE A MANHA">4050 - ADMINISTRAÇÃO - 2ª SERIE A MANHA</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label for="student" class="required">Nome do aluno</label>
                                            <select id="student" required disabled>
                                                <option value="">Selecione primeiro a turma</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="section-title">
                                    <i class="fas fa-exclamation-triangle"></i> Irregularidades
                                </div>
                                
                                <div class="checkbox-group">
                                    <label>Selecione as irregularidades (pelo menos uma):</label>
                                    <div class="checkbox-container">
                                        <div class="checkbox-item">
                                            <div class="chart-container">
                                                <canvas class="donut-chart" width="50" height="50" data-irregularity="Não fez a lição"></canvas>
                                                <span class="chart-value">0</span>
                                            </div>
                                            <input type="checkbox" id="irregularity1" name="irregularity" value="Não fez a lição">
                                            <label for="irregularity1">Não fez a lição</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <div class="chart-container">
                                                <canvas class="donut-chart" width="50" height="50" data-irregularity="Não trouxe material"></canvas>
                                                <span class="chart-value">0</span>
                                            </div>
                                            <input type="checkbox" id="irregularity2" name="irregularity" value="Não trouxe material">
                                            <label for="irregularity2">Não trouxe material</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <div class="chart-container">
                                                <canvas class="donut-chart" width="50" height="50" data-irregularity="Fora do lugar constantemente durante a aula"></canvas>
                                                <span class="chart-value">0</span>
                                            </div>
                                            <input type="checkbox" id="irregularity3" name="irregularity" value="Fora do lugar constantemente durante a aula">
                                            <label for="irregularity3">Fora do lugar durante a aula</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <div class="chart-container">
                                                <canvas class="donut-chart" width="50" height="50" data-irregularity="Chegou atrasado"></canvas>
                                                <span class="chart-value">0</span>
                                            </div>
                                            <input type="checkbox" id="irregularity4" name="irregularity" value="Chegou atrasado">
                                            <label for="irregularity4">Chegou atrasado</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <div class="chart-container">
                                                <canvas class="donut-chart" width="50" height="50" data-irregularity="Circulando no corredor durante a aula"></canvas>
                                                <span class="chart-value">0</span>
                                            </div>
                                            <input type="checkbox" id="irregularity5" name="irregularity" value="Circulando no corredor durante a aula">
                                            <label for="irregularity5">Circulando no corredor</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <div class="chart-container">
                                                <canvas class="donut-chart" width="50" height="50" data-irregularity="Uso indevido do celular durante a aula"></canvas>
                                                <span class="chart-value">0</span>
                                            </div>
                                            <input type="checkbox" id="irregularity6" name="irregularity" value="Uso indevido do celular durante a aula">
                                            <label for="irregularity6">Uso indevido do celular</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <div class="chart-container">
                                                <canvas class="donut-chart" width="50" height="50" data-irregularity="Interrompe a aula constantemente"></canvas>
                                                <span class="chart-value">0</span>
                                            </div>
                                            <input type="checkbox" id="irregularity7" name="irregularity" value="Interrompe a aula constantemente">
                                            <label for="irregularity7">Interrompe a aula constantemente</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <div class="chart-container">
                                                <canvas class="donut-chart" width="50" height="50" data-irregularity="Falta de cuidado com o ambiente e o material"></canvas>
                                                <span class="chart-value">0</span>
                                            </div>
                                            <input type="checkbox" id="irregularity8" name="irregularity" value="Falta de cuidado com o ambiente e o material">
                                            <label for="irregularity8">Falta de cuidado com ambiente/material</label>
                                        </div>
                                        <div class="checkbox-item">
                                            <div class="chart-container">
                                                <canvas class="donut-chart" width="50" height="50" data-irregularity="Vestimenta inadequada"></canvas>
                                                <span class="chart-value">0</span>
                                            </div>
                                            <input type="checkbox" id="irregularity9" name="irregularity" value="Vestimenta inadequada">
                                            <label for="irregularity9">Vestimenta inadequada</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="description">Breve relato do ocorrido</label>
                                    <textarea id="description" placeholder="Descreva detalhadamente a ocorrência..."></textarea>
                                </div>
                                
                                <div class="actions">
                                    <button type="submit" class="btn btn-primary" id="submitBtn">
                                        <i class="fas fa-paper-plane"></i> Enviar Ocorrência
                                    </button>
                                    <button type="button" id="clearBtn" class="btn btn-secondary">
                                        <i class="fas fa-broom"></i> Limpar formulário
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                
                <div>
                    <div class="stats-card">
                        <div class="card-header">
                            <i class="fas fa-chart-line"></i> Estatísticas do Sistema
                        </div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value" id="totalOccurrences">0</div>
                                <div class="stat-label">Ocorrências registradas</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="totalStudents">0</div>
                                <div class="stat-label">Total de alunos</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="totalClasses">40</div>
                                <div class="stat-label">Turmas monitoradas</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="totalTeachers">64</div>
                                <div class="stat-label">Professores ativos</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="student-occurrences-card" id="studentOccurrencesCard">
                        <div class="student-occurrences-content">
                            <div class="student-occurrences-name" id="studentOccurrencesName">Nome do Aluno</div>
                            <div class="student-occurrences-count" id="studentOccurrencesCount">0</div>
                            <div class="student-occurrences-label">Ocorrências registradas</div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-info-circle"></i> Sobre o Sistema
                        </div>
                        <div class="card-body">
                            <p>Este sistema permite o registro de ocorrências escolares com integração direta ao Google Sheets.</p>
                            <br>
                            <p><strong>Funcionalidades:</strong></p>
                            <ul style="padding-left: 20px; margin-top: 10px;">
                                <li>Seleção de turma com carregamento automático dos alunos</li>
                                <li>Registro detalhado de ocorrências</li>
                                <li>Integração em tempo real com planilha Google</li>
                                <li>Estatísticas atualizadas</li>
                                <li>Interface amigável e responsiva</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <footer>
        <div class="footer-links">
            <a href="#"><i class="fas fa-envelope"></i> Contato</a>
            <a href="#"><i class="fas fa-file-contract"></i> Termos de Serviço</a>
            <a href="#"><i class="fas fa-shield-alt"></i> Política de Privacidade</a>
            <a href="#"><i class="fas fa-flag"></i> Denunciar</a>
        </div>
        <div style="margin-top: 10px;">
            Sistema de Gestão Escolar © 2025
        </div>
    </footer>
    
    <script>
        // ===== CONFIGURAÇÃO PRINCIPAL =====
        const CONFIG = {
            // SUBSTITUA ESTA URL PELA URL DO SEU GOOGLE APPS SCRIPT APÓS O DEPLOY
            SCRIPT_URL: 'https://script.google.com/macros/s/SEU_SCRIPT_ID_AQUI/exec',
            SPREADSHEET_ID: '1u7qMsMHkZT47OZdar5qvshQDRA8XJrLgDjAZVOViAio',
            TIMEOUT: 30000, // 30 segundos
            MAX_RETRIES: 3
        };

        // ===== DADOS DOS PROFESSORES =====
        const TEACHERS = [
            "ALEX LUTH PEREIRA MARANHAO",
            "ALEXSANDRA PAULA VARELLA DE SOUZA",
            "ALISON VASCONCELOS BESERRA",
            "AMAURI TEODORO DE OLIVEIRA",
            "ANA PAULA DOS SANTOS",
            "ANDREIA DOS SANTOS FREITAS",
            "ANDREIA MADUREIRA REIS",
            "ANTONIO CARLOS DE OLIVEIRA",
            "ANTONIO RAMOS DE ARAUJO",
            "ANTONIO WILTON WANDERLEY CABRAL",
            "AUGUSTO LINO PESSOA NETO",
            "AUREA MARIA DE JESUS MARQUES",
            "CAROLINA PERNOMIAN PARUSSOLO",
            "CASSIA OLIVEIRA ANTONIAZI",
            "CLAUDINEIA DE AGUIAR LIMA",
            "DANIEL DE FREITAS ALMEIDA",
            "DANIEL LOPES BARBOSA",
            "DANIELA FERREIRA LIMA",
            "DANIELLE LUCIA BATISTA DE ALMEIDA",
            "EDIANE VIEIRA DA SILVA",
            "EDILEUSA NUNES PEREIRA",
            "EDUARDO HENRIQUE DA FONSECA",
            "ELIANE SANTOS SILVA",
            "ELIAS MONTEIRO DA SILVA",
            "ELISABETE APARECIDA PIRES",
            "ELZA DE FARIA PEREIRA",
            "EMERSON GABLER DE ALMEIDA",
            "EUZELI ARAUJO DE OLIVEIRA",
            "FABIANO AUGUSTO PIEDADE",
            "FABIO CAMILO",
            "FERNANDO JOSE DA SILVA FILHO",
            "FLAVIA CRISTINA APARECIDA BICHLER",
            "FLAVIO CARDOSO FLEURY",
            "FRANCISCA EDIVANIA DE MORAIS COSTA",
            "GABRIELA SERIGHELLI DE MELO",
            "GELSON DE ALMEIDA BATISTA",
            "GENILTON DE OLIVEIRA SILVA",
            "GIANI CRISTINA DO PRADO",
            "INGRYD CAROLINA SUGUIMOTO VIEIRA",
            "IVANILDES DOS SANTOS OSHIKAWA",
            "JANINA DOS PASSOS BRAGA DE ALMEIDA",
            "JOSE APARECIDO DA SILVA",
            "JUAREZ GOMES DE MAGALHAES FILHO",
            "JUREMA SOLEDADE FURINI SANTOS",
            "KATIUSCIA ALVES BOMFIM",
            "LUANA CAROLINE ALVES LIMA",
            "LUANA DE FREITAS SILVA",
            "LUCIANA NOVAIS CORREIA SANTOS",
            "LUCIANO MOREIRA DE AZEVEDO",
            "MARCIEL DA SILVA",
            "MARIA HELENA CUNHA MORO",
            "MARIA QUITÉRIA FERREIRA DOS SANTOS",
            "MARINA DA CONCEICAO FRANCISCO SILVA",
            "MAURICIO DE BARROS SANTOS",
            "MICHELE DE PINHO MORAES",
            "MOISES ANTONIO DE BARROS",
            "PAULA ARMANI VILA",
            "PAULO ROBERTO DA SILVA ITO",
            "PEDRO ZANOTTI FILHO",
            "RAUL PEREIRA VILERA JUNIOR",
            "REGIANE CURTI DE SOUZA OLIVEIRA",
            "REGINA DA SILVA CASTRO",
            "RICARDO AMERICO DA SILVA",
            "ROBERTO SALGADO",
            "RODRIGO VIEIRA",
            "ROSANGELA CAFASSO MOREIRA",
            "ROSIMERY DE SOUZA PESSOA",
            "ROSMARA DA SILVA CARDOSO",
            "SANDRA CRISTINA MACEDO MORAES",
            "SELMA GOMES DA SILVA",
            "SERGIO AGRIPINO VILLA NOVA",
            "SOLANGE ALMEIDA DA SILVA",
            "SUZINEIDE SILVA DE FREITAS",
            "THIAGO FABIANO BRITO",
            "TITTO AUGUSTO NASCIMENTO SILVA",
            "VANDERSON HYPPOLITO",
            "VANESSA IVETE GOMES DOS SANTOS",
            "VANIA PENHA DE BARROS",
            "VIVIANE LEAL CAMERA DE MORAES",
            "WILSON RODRIGUES MOTA"
        ];

        // ===== ELEMENTOS DOM =====
        const elements = {
            form: document.getElementById('occurrenceForm'),
            clearBtn: document.getElementById('clearBtn'),
            submitBtn: document.getElementById('submitBtn'),
            successAlert: document.getElementById('successAlert'),
            errorAlert: document.getElementById('errorAlert'),
            errorMessage: document.getElementById('errorMessage'),
            studentSelect: document.getElementById('student'),
            classSelect: document.getElementById('studentClass'),
            professorSelect: document.getElementById('professor'),
            totalOccurrencesEl: document.getElementById('totalOccurrences'),
            totalStudentsEl: document.getElementById('totalStudents'),
            studentOccurrencesCard: document.getElementById('studentOccurrencesCard'),
            studentOccurrencesName: document.getElementById('studentOccurrencesName'),
            studentOccurrencesCount: document.getElementById('studentOccurrencesCount'),
            loadingOverlay: document.getElementById('loadingOverlay'),
            connectionStatus: document.getElementById('connectionStatus'),
            connectionText: document.getElementById('connectionText')
        };

        // ===== VARIÁVEIS GLOBAIS =====
        let charts = {};
        let currentStudents = [];
        let connectionHealthy = false;

        // ===== FUNÇÕES UTILITÁRIAS =====
        
        function showLoading() {
            elements.loadingOverlay.style.display = 'flex';
        }
        
        function hideLoading() {
            elements.loadingOverlay.style.display = 'none';
        }

        function showAlert(type, message) {
            hideAlerts();
            const alert = type === 'success' ? elements.successAlert : elements.errorAlert;
            if (type === 'error') {
                elements.errorMessage.innerHTML = message;
            }
            alert.style.display = 'flex';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function hideAlerts() {
            elements.successAlert.style.display = 'none';
            elements.errorAlert.style.display = 'none';
        }

        function updateConnectionStatus(isConnected) {
            connectionHealthy = isConnected;
            const statusEl = elements.connectionStatus;
            const textEl = elements.connectionText;
            
            if (isConnected) {
                statusEl.className = 'status-indicator status-connected';
                textEl.textContent = 'Conectado à planilha Google Sheets';
            } else {
                statusEl.className = 'status-indicator status-disconnected';
                textEl.textContent = 'Erro de conexão com Google Sheets';
            }
        }

        // ===== FUNÇÕES DE REQUISIÇÃO =====
        
        async function makeRequest(url, options = {}) {
            let lastError;
            
            for (let attempt = 1; attempt <= CONFIG.MAX_RETRIES; attempt++) {
                try {
                    console.log(`Tentativa ${attempt} de ${CONFIG.MAX_RETRIES}:`, url);
                    
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), CONFIG.TIMEOUT);
                    
                    const response = await fetch(url, {
                        ...options,
                        signal: controller.signal,
                        mode: 'cors',
                        credentials: 'omit',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json',
                            ...options.headers
                        }
                    });
                    
                    clearTimeout(timeoutId);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const contentType = response.headers.get('content-type');
                    if (!contentType || !contentType.includes('application/json')) {
                        const text = await response.text();
                        throw new Error(`Resposta não é JSON válido: ${text.substring(0, 200)}`);
                    }
                    
                    const data = await response.json();
                    console.log('Resposta recebida:', data);
                    
                    updateConnectionStatus(true);
                    return data;
                    
                } catch (error) {
                    lastError = error;
                    console.error(`Tentativa ${attempt} falhou:`, error);
                    
                    if (error.name === 'AbortError') {
                        lastError = new Error('Timeout: A requisição demorou muito para responder');
                    }
                    
                    if (attempt < CONFIG.MAX_RETRIES) {
                        await new Promise(resolve => setTimeout(resolve, 1000 * attempt));
                    }
                }
            }
            
            updateConnectionStatus(false);
            throw lastError;
        }

        async function getStudentsByClass(className) {
            const url = `${CONFIG.SCRIPT_URL}?action=getStudentsByClass&class=${encodeURIComponent(className)}&spreadsheetId=${CONFIG.SPREADSHEET_ID}`;
            return await makeRequest(url);
        }

        async function getStudentOccurrences(studentName) {
            const url = `${CONFIG.SCRIPT_URL}?action=getStudentOccurrences&student=${encodeURIComponent(studentName)}&spreadsheetId=${CONFIG.SPREADSHEET_ID}`;
            return await makeRequest(url);
        }

        async function getIrregularityStats() {
            const url = `${CONFIG.SCRIPT_URL}?action=getIrregularityStats&spreadsheetId=${CONFIG.SPREADSHEET_ID}`;
            return await makeRequest(url);
        }

        async function getStatistics() {
            const url = `${CONFIG.SCRIPT_URL}?action=getStatistics&spreadsheetId=${CONFIG.SPREADSHEET_ID}`;
            return await makeRequest(url);
        }

        async function addOccurrence(occurrenceData) {
            return await makeRequest(CONFIG.SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({
                    action: 'addOccurrence',
                    ...occurrenceData,
                    spreadsheetId: CONFIG.SPREADSHEET_ID
                })
            });
        }

        // ===== FUNÇÕES DE GRÁFICOS =====
        
        function createDonutChart(canvas, value, maxValue = 10) {
            const ctx = canvas.getContext('2d');
            const chartKey = canvas.getAttribute('data-irregularity');

            if (charts[chartKey]) {
                charts[chartKey].destroy();
            }

            charts[chartKey] = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [value, Math.max(0, maxValue - value)],
                        backgroundColor: ['#3498db', '#e0e0e0'],
                        borderWidth: 0
                    }]
                },
                options: {
                    cutout: '70%',
                    responsive: false,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    }
                }
            });

            const chartValue = canvas.parentElement.querySelector('.chart-value');
            if (chartValue) {
                chartValue.textContent = value;
            }
        }

        function updateAllCharts(stats) {
            const chartCanvases = document.querySelectorAll('.donut-chart');
            chartCanvases.forEach(canvas => {
                const irregularity = canvas.getAttribute('data-irregularity');
                const count = stats[irregularity] || 0;
                createDonutChart(canvas, count);
            });
        }

        // ===== INICIALIZAÇÃO =====
        
        function initializeForm() {
            // Preencher dropdown de professores
            TEACHERS.forEach(teacher => {
                const option = document.createElement('option');
                option.value = teacher;
                option.textContent = teacher;
                elements.professorSelect.appendChild(option);
            });

            // Definir data atual
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('occurrenceDate').value = today;

            // Inicializar gráficos
            document.querySelectorAll('.donut-chart').forEach(canvas => {
                createDonutChart(canvas, 0);
            });

            // Atualizar contadores estáticos
            document.getElementById('totalTeachers').textContent = TEACHERS.length;
        }

        // ===== EVENT LISTENERS =====
        
        // Mudança de turma
        elements.classSelect.addEventListener('change', async function() {
            const selectedClass = this.value;
            elements.studentSelect.innerHTML = '<option value="">Carregando alunos...</option>';
            elements.studentSelect.disabled = true;
            elements.studentOccurrencesCard.style.display = 'none';

            // Resetar gráficos
            document.querySelectorAll('.donut-chart').forEach(canvas => {
                createDonutChart(canvas, 0);
            });

            if (!selectedClass) {
                elements.studentSelect.innerHTML = '<option value="">Selecione uma turma</option>';
                return;
            }

            showLoading();
            
            try {
                const data = await getStudentsByClass(selectedClass);
                
                if (data && data.status === "success" && Array.isArray(data.students)) {
                    elements.studentSelect.innerHTML = '<option value="">Selecione um aluno</option>';
                    
                    currentStudents = data.students;
                    data.students.forEach(student => {
                        const option = document.createElement('option');
                        const studentName = typeof student === 'object' ? student.name : student;
                        option.value = studentName;
                        option.textContent = studentName;
                        elements.studentSelect.appendChild(option);
                    });
                    
                    elements.studentSelect.disabled = false;
                } else {
                    throw new Error(data?.message || 'Erro ao carregar alunos');
                }
            } catch (error) {
                console.error('Erro ao carregar alunos:', error);
                elements.studentSelect.innerHTML = '<option value="">Erro ao carregar. Tente novamente.</option>';
                showAlert('error', `Erro ao carregar alunos: ${error.message}`);
            } finally {
                hideLoading();
            }
        });

        // Mudança de aluno
        elements.studentSelect.addEventListener('change', async function() {
            if (!this.value) {
                elements.studentOccurrencesCard.style.display = 'none';
                document.querySelectorAll('.donut-chart').forEach(canvas => {
                    createDonutChart(canvas, 0);
                });
                return;
            }

            elements.studentOccurrencesCard.style.display = 'block';
            elements.studentOccurrencesName.textContent = this.value;
            elements.studentOccurrencesCount.textContent = "Carregando...";

            showLoading();
            
            try {
                const data = await getStudentOccurrences(this.value);
                
                if (data && data.status === "success") {
                    elements.studentOccurrencesCount.textContent = data.count || 0;
                } else {
                    throw new Error(data?.message || 'Erro ao carregar ocorrências do aluno');
                }

                // Carregar estatísticas de irregularidades
                const statsData = await getIrregularityStats();
                if (statsData && statsData.status === "success") {
                    updateAllCharts(statsData.irregularities || {});
                }
            } catch (error) {
                console.error('Erro ao carregar dados do aluno:', error);
                elements.studentOccurrencesCount.textContent = "0";
            } finally {
                hideLoading();
            }
        });

        // Limpar formulário
        elements.clearBtn.addEventListener('click', function() {
            elements.form.reset();
            
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('occurrenceDate').value = today;
            
            elements.professorSelect.selectedIndex = 0;
            elements.classSelect.selectedIndex = 0;
            elements.studentSelect.innerHTML = '<option value="">Selecione primeiro a turma</option>';
            elements.studentSelect.disabled = true;
            
            hideAlerts();
            elements.studentOccurrencesCard.style.display = 'none';

            document.querySelectorAll('.donut-chart').forEach(canvas => {
                createDonutChart(canvas, 0);
            });

            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
        });

        // Enviar formulário
        elements.form.addEventListener('submit', async function(e) {
            e.preventDefault();
            hideAlerts();

            // Coletar dados
            const professor = elements.professorSelect.value;
            const occurrenceDate = document.getElementById('occurrenceDate').value;
            const student = elements.studentSelect.value;
            const classInfo = elements.classSelect.value;
            const description = document.getElementById('description').value;

            const irregularities = [];
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
                irregularities.push(cb.value);
            });

            // Validação
            let errors = [];
            if (!professor) errors.push("Selecione o professor");
            if (!occurrenceDate) errors.push("Informe a data da ocorrência");
            if (!classInfo) errors.push("Selecione a turma");
            if (!student) errors.push("Selecione o aluno");
            if (irregularities.length === 0) errors.push("Selecione pelo menos uma irregularidade");

            if (errors.length > 0) {
                showAlert('error', `<strong>Erros encontrados:</strong><br>• ${errors.join('<br>• ')}`);
                return;
            }

            // Enviar dados
            const originalBtnText = elements.submitBtn.innerHTML;
            elements.submitBtn.innerHTML = '<span class="loading"></span> Enviando...';
            elements.submitBtn.disabled = true;
            showLoading();

            try {
                const formData = {
                    professor: professor,
                    date: occurrenceDate,
                    student: student,
                    class: classInfo,
                    irregularities: irregularities.join(', '),
                    description: description
                };

                const response = await addOccurrence(formData);

                if (response && response.status === "success") {
                    showAlert('success', 'Ocorrência registrada com sucesso!');
                    
                    // Resetar formulário
                    elements.form.reset();
                    const today = new Date().toISOString().split('T')[0];
                    document.getElementById('occurrenceDate').value = today;
                    elements.studentSelect.innerHTML = '<option value="">Selecione primeiro a turma</option>';
                    elements.studentSelect.disabled = true;
                    elements.classSelect.selectedIndex = 0;
                    elements.studentOccurrencesCard.style.display = 'none';

                    // Atualizar estatísticas
                    loadStatistics();
                } else {
                    throw new Error(response?.message || "Erro desconhecido ao enviar ocorrência");
                }
            } catch (error) {
                console.error('Erro ao enviar ocorrência:', error);
                showAlert('error', `Erro ao enviar a ocorrência: ${error.message}`);
            } finally {
                elements.submitBtn.innerHTML = originalBtnText;
                elements.submitBtn.disabled = false;
                hideLoading();
            }
        });

        // ===== CARREGAMENTO DE ESTATÍSTICAS =====
        
        async function loadStatistics() {
            try {
                const data = await getStatistics();
                
                if (data && data.status === "success") {
                    elements.totalOccurrencesEl.textContent = data.totalOccurrences || 0;
                    // Adicionar outras estatísticas conforme necessário
                }
            } catch (error) {
                console.error('Erro ao carregar estatísticas:', error);
            }
        }

        // ===== INICIALIZAÇÃO DA APLICAÇÃO =====
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Inicializando aplicação...');
            
            // Verificar se a URL do script foi configurada
            if (CONFIG.SCRIPT_URL.includes('SEU_SCRIPT_ID_AQUI')) {
                showAlert('error', '<strong>Configuração necessária:</strong><br>Por favor, substitua a URL do Google Apps Script na variável CONFIG.SCRIPT_URL');
                updateConnectionStatus(false);
                return;
            }
            
            initializeForm();
            loadStatistics();
            
            console.log('Aplicação inicializada com sucesso!');
        });

        // ===== TRATAMENTO DE ERROS GLOBAIS =====
        
        window.addEventListener('error', function(e) {
            console.error('Erro global capturado:', e.error);
            updateConnectionStatus(false);
        });

        window.addEventListener('unhandledrejection', function(e) {
            console.error('Promise rejeitada não tratada:', e.reason);
            updateConnectionStatus(false);
        });
    </script>
</body>
</html>
